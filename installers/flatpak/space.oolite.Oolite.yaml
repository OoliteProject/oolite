app-id: space.oolite.Oolite
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm21
  - org.freedesktop.Sdk.Extension.rust-stable
build-options:
  append-path: /usr/lib/sdk/llvm21/bin:/usr/lib/sdk/rust-stable/bin
  prepend-ld-library-path: /usr/lib/sdk/llvm21/lib
command: run_oolite.sh
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --device=dri
cleanup:
  - /include
  - /lib/pkgconfig
  - /share/man
  - "*.a"
  - "*.la"
modules:
  - shared-modules/glu/glu-9.json
  - name: sdl12-compat
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: git
        url: https://github.com/libsdl-org/sdl12-compat.git
        tag: release-1.2.74
        commit: 8cb4550f9aff307e3df6ce628c2bb1287c6c105b
    cleanup:
      - /bin
      - /share
  - name: pcaudiolib
    sources:
      - type: archive
        url: "https://github.com/espeak-ng/pcaudiolib/archive/refs/tags/1.3.tar.gz"
        sha256: "86edb75048eec7fcd8d74f9568f051d50b4781982215095b96ba9c2c9c7c159b"
  - name: espeak-ng
    sources:
      - type: archive
        url: "https://github.com/espeak-ng/espeak-ng/archive/refs/tags/1.52.0.tar.gz"
        sha256: "bb4338102ff3b49a81423da8a1a158b420124b055b60fa76cfb4b18677130a23"
  - name: robin-map
    buildsystem: cmake-ninja
    build-options:
      env:
        CC: clang
        CXX: clang++
        ASM: clang
    sources:
      - type: archive
        url: "https://github.com/Tessil/robin-map/archive/refs/tags/v1.4.1.tar.gz"
        sha256: "0e3f53a377fdcdc5f9fed7a4c0d4f99e82bbb64175233bd13427fef9a771f4a1"
  - name: libobjc2
    buildsystem: cmake-ninja
    build-options:
      env:
        CC: clang
        CXX: clang++
    config-opts:
      - -DTESTS=on
      - -DCMAKE_BUILD_TYPE=Release
      - -DGNUSTEP_INSTALL_TYPE=NONE
      - -DEMBEDDED_BLOCKS_RUNTIME=ON
      - -DOLDABI_COMPAT=OFF
    sources:
      - type: git
        url: https://github.com/gnustep/libobjc2.git
        commit: e5c06e3be8895007bcc7be58cbeccac2a5a89eff
  - name: gnustep-make
    build-options:
      env:
        CC: clang
        CXX: clang++
    config-opts:
      - --with-library-combo=ng-gnu-gnu
      - --with-runtime-abi=gnustep-2.2
    sources:
      - type: archive
        url: "https://github.com/gnustep/tools-make/releases/download/make-2_9_3/gnustep-make-2.9.3.tar.gz"
        sha256: "93ca320b706279ebca53760da89d4c3f2bbc547f4723967140a34346d9f04c24"
  - name: gnustep-base
    build-options:
      env:
        CC: clang
        CXX: clang++
    sources:
      - type: git
        url: https://github.com/gnustep/libs-base.git
        commit: 2b236ec2c4816e7ff482f07dc973b655a3780122
  - name: oolite
    buildsystem: simple
    secret-env:
      - FLATPAK_VERSION
    build-commands:
      - |
        source /app/share/GNUstep/Makefiles/GNUstep.sh
        make -f Makefile release-deployment -j$FLATPAK_BUILDER_N_JOBS
        source installers/flatpak/flatpak_postbuild.sh
    sources:
      - type: file
        url: https://wiki.alioth.net/img_auth.php/a/a2/Oolite-logo3.png
        sha256: e1d13be05d665480d034ff5f824ab5463463f16dd411de25f870522e3d3e45b1
        dest-filename: Oolite-logo3.png
      - type: dir
        path: ../
#      For the FlatHub release, use the lines below instead of the 2 above updating the tag and commit:
#      - type: git
#        url: https://github.com/OoliteProject/oolite.git
#        tag: "1.92"
#        commit: ca6d91a33b7acd5b80a307a9f12643281a36f423
